<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Todo App â€” Fetch + LocalStorage</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: auto; }
    h1 { margin-bottom: 10px; }
    #controls { display:flex; gap:10px; margin-bottom: 20px; align-items:center; }
    #todos { list-style: none; padding: 0; margin:0; }
    .todo { display:flex; align-items:center; justify-content:space-between; padding:8px; border:1px solid #ddd; margin-bottom:8px; border-radius:6px; }
    .left { display:flex; gap:10px; align-items:center; max-width:75%; }
    .title { word-break: break-word; }
    button { padding:6px 10px; border-radius:6px; border:1px solid #bbb; background:#fff; cursor:pointer; }
    button.delete { background:#ffefef; border-color:#ff9b9b; }
    .completed { text-decoration: line-through; color: #777; }
  </style>
</head>
<body>
  <h1>Todo App (API + localStorage)</h1>

  <div id="controls">
    <button id="fetchBtn">Fetch & Store First 20 Todos</button>
    <button id="loadBtn">Load from LocalStorage & Render</button>
    <span id="status"></span>
  </div>

  <ul id="todos"></ul>

<script>
  const LS_KEY = 'todos_v1';


  async function fetchTodos() {
    setStatus('Fetching todos...');
    try {
      const res = await fetch('https://jsonplaceholder.typicode.com/todos');
      if (!res.ok) throw new Error('Network response not ok: ' + res.status);
      const all = await res.json();
      const first20 = all.slice(0, 20).map(t => ({
        id: t.id,
        title: t.title,
        completed: !!t.completed
      }));
      setStatus('Fetched ' + first20.length + ' todos.');
      return first20;
    } catch (err) {
      setStatus('Fetch failed: ' + err.message);
      console.error(err);
      return [];
    }
  }

  function storeTodos(todos) {
    localStorage.setItem(LS_KEY, JSON.stringify(todos));
    setStatus('Stored ' + todos.length + ' todos in LocalStorage.');
  }


  function loadTodosFromStorage() {
    const raw = localStorage.getItem(LS_KEY);
    if (!raw) return [];
    try {
      const arr = JSON.parse(raw);
      if (!Array.isArray(arr)) return [];
      return arr;
    } catch {
      return [];
    }
  }

  function renderTodos() {
    const ul = document.getElementById('todos');
    ul.innerHTML = '';
    const todos = loadTodosFromStorage();

    if (todos.length === 0) {
      ul.innerHTML = '<li>No todos in storage. Click "Fetch & Store First 20 Todos".</li>';
      return;
    }

    todos.forEach(t => {
      const li = document.createElement('li');
      li.className = 'todo';
      li.dataset.id = t.id;

      const left = document.createElement('div');
      left.className = 'left';

      const chk = document.createElement('input');
      chk.type = 'checkbox';
      chk.checked = !!t.completed;
      chk.addEventListener('change', () => toggleCompleted(t.id, chk.checked));

      const title = document.createElement('div');
      title.className = 'title';
      title.textContent = t.title;
      if (t.completed) title.classList.add('completed');

      left.appendChild(chk);
      left.appendChild(title);

      const right = document.createElement('div');
      const delBtn = document.createElement('button');
      delBtn.textContent = 'Delete';
      delBtn.className = 'delete';
      delBtn.addEventListener('click', () => deleteTodo(t.id));

      right.appendChild(delBtn);

      li.appendChild(left);
      li.appendChild(right);
      ul.appendChild(li);
    });
  }

  
  function toggleCompleted(id, completed) {
    const todos = loadTodosFromStorage();
    const idx = todos.findIndex(x => x.id === id);
    if (idx === -1) return;
    todos[idx].completed = completed;
    storeTodos(todos);
    renderTodos();
  }

  
  function deleteTodo(id) {
    let todos = loadTodosFromStorage();
    todos = todos.filter(t => t.id !== id);
    storeTodos(todos);
    renderTodos();
    setStatus('Deleted todo ' + id);
  }

  function setStatus(text) {
    document.getElementById('status').textContent = text || '';
  }

  
  document.getElementById('fetchBtn').addEventListener('click', async () => {
    const todos = await fetchTodos();
    if (todos.length) storeTodos(todos);
    renderTodos();
  });

  document.getElementById('loadBtn').addEventListener('click', () => renderTodos());


  renderTodos();
</script>
</body>
</html>
